<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Analytics | FoodShare</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3 col-lg-2 d-none d-md-block">
            <div th:replace="~{fragments/sidebar_simple :: sidebar}"></div>
        </div>
        <main class="col-md-9 ms-sm-auto col-lg-10 px-lg-4 py-4">
            <div class="d-flex flex-wrap justify-content-between mb-4 align-items-center">
                <h2 class="gradient-text fw-bold"><i class="fas fa-chart-line me-2"></i>Analytics & Impact</h2>
            </div>
            
            <!-- Stats Cards -->
            <div class="row g-4 mb-4">
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="glass-stat-card text-center p-4 shadow rounded-4 h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-hand-holding-heart fa-3x mb-3 text-white opacity-75"></i>
                        <div class="fs-2 fw-bold text-white" th:text="${totalDonations != null ? totalDonations : '0'}">0</div>
                        <div class="text-white opacity-75">Total Donations</div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="glass-stat-card text-center p-4 shadow rounded-4 h-100" style="background: linear-gradient(135deg, #48c9b0 0%, #06beb6 100%);">
                        <i class="fas fa-users fa-3x mb-3 text-white opacity-75"></i>
                        <div class="fs-2 fw-bold text-white" th:text="${peopleFed != null ? peopleFed : '0'}">0</div>
                        <div class="text-white opacity-75">People Fed (Est.)</div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-lg-4">
                    <div class="glass-stat-card text-center p-4 shadow rounded-4 h-100" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <i class="fas fa-award fa-3x mb-3 text-white opacity-75"></i>
                        <div class="fs-2 fw-bold text-white">
                            <span th:if="${totalDonations != null && totalDonations >= 10}">‚≠ê Champion</span>
                            <span th:if="${totalDonations != null && totalDonations >= 5 && totalDonations < 10}">üèÖ Hero</span>
                            <span th:if="${totalDonations != null && totalDonations > 0 && totalDonations < 5}">‚ú® Rising</span>
                            <span th:if="${totalDonations == null || totalDonations == 0}">üå± Beginner</span>
                        </div>
                        <div class="text-white opacity-75">Your Impact Level</div>
                    </div>
                </div>
            </div>
            
            <!-- Charts and Feedback -->
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="glass-card p-4 rounded-4 shadow h-100">
                        <h6 class="fw-semibold mb-4"><i class="fas fa-chart-pie me-2"></i>Donation by Type</h6>
                        <div th:if="${totalDonations == null || totalDonations == 0}" class="text-center py-5">
                            <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                            <p class="text-muted">No data yet. Start donating to see your impact!</p>
                        </div>
                        <canvas th:if="${totalDonations != null && totalDonations > 0}" id="donationTypePie" height="200"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="glass-card p-4 h-100 rounded-4 shadow">
                        <h6 class="fw-semibold mb-4"><i class="fas fa-lightbulb me-2"></i>Your Impact</h6>
                        
                        <div class="mb-3 p-3 rounded-3" style="background: rgba(72, 201, 176, 0.1);">
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-leaf fa-2x me-3" style="color: #48c9b0;"></i>
                                <div>
                                    <div class="fw-semibold">Environmental Impact</div>
                                    <div class="small text-muted">
                                        <span th:text="${totalDonations != null ? totalDonations * 2 : 0}">0</span> kg CO‚ÇÇ saved
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3 p-3 rounded-3" style="background: rgba(102, 126, 234, 0.1);">
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-heart fa-2x me-3" style="color: #667eea;"></i>
                                <div>
                                    <div class="fw-semibold">Social Impact</div>
                                    <div class="small text-muted">
                                        Helped <span th:text="${peopleFed != null ? peopleFed : 0}">0</span> people in need
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="p-3 rounded-3" style="background: rgba(255, 107, 107, 0.1);">
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-trophy fa-2x me-3" style="color: #ff6b6b;"></i>
                                <div>
                                    <div class="fw-semibold">Community Ranking</div>
                                    <div class="small text-muted">
                                        <span th:if="${totalDonations != null && totalDonations >= 10}">Top 10% of donors</span>
                                        <span th:if="${totalDonations != null && totalDonations >= 5 && totalDonations < 10}">Top 25% of donors</span>
                                        <span th:if="${totalDonations != null && totalDonations > 0 && totalDonations < 5}">Keep going! You're making a difference</span>
                                        <span th:if="${totalDonations == null || totalDonations == 0}">Start donating to build your ranking</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('donationTypePie');
        if (ctx) {
            const vegCount = [[${vegCount}]] || 0;
            const nonVegCount = [[${nonVegCount}]] || 0;
            const otherCount = [[${otherCount}]] || 0;
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ü•ó Vegetarian', 'üçó Non-Vegetarian', 'üç∞ Other'],
                    datasets: [{
                        data: [vegCount, nonVegCount, otherCount],
                        backgroundColor: ['#48C9B0', '#FF6B6B', '#FFD93D'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    size: 13,
                                    weight: '500'
                                },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            padding: 12,
                            cornerRadius: 8,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            }
                        }
                    }
                }
            });
        }
    });
</script>
</body>
</html>
